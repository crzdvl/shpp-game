<!DOCTYPE html>
<html lang = 'en'>
  <head>
    <meta charset="utf-8">
    <title>ш++</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Play">
    <style>
      body {
        margin: 0%;
        padding: 0%;
        overflow:hidden;
      }
    </style>
    <link rel="icon" href="https://media.geeksforgeeks.org/wp-content/cdn-uploads/gfg_200X200.png" type = "image/x-icon">
  </head>
  <body>
  
  <div id="background" class="day">
    <div id="GameOverMenu">
      <div id="GameOverText">GAME OVER</div>
      <span id="GameOverShText">
        Ш =
        <span id="GameOverShScore" class='highscore'>0</span>
      </span>
      <div id="GameOverRestartButton" onclick = "restartAnim()">
        <svg id="restartSvg" width="39" height="43" viewBox="0 0 39 43" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21.5562 42.8795C30.182 41.9132 37.0949 35.0179 38.0787 26.3921C39.3699 15.1136 30.6036 5.51285 19.615 5.38987V0.330358C19.615 0.0492735 19.2636 -0.100052 19.0264 0.0756251L8.60875 7.72638C8.43307 7.85814 8.43307 8.11287 8.60875 8.24463L19.0264 15.8954C19.2636 16.0711 19.615 15.913 19.615 15.6407V10.5899C27.336 10.7129 33.5198 17.2832 32.9928 25.136C32.5448 31.8908 27.0373 37.372 20.2825 37.8024C13.1237 38.2591 7.03644 33.1469 5.94724 26.3833C5.74521 25.1272 4.64722 24.2137 3.38234 24.2137C1.81003 24.2137 0.580284 25.6104 0.826233 27.1651C2.35463 36.801 11.2527 44.0302 21.5562 42.8795Z" fill="#F8F8F8"/>
        </svg>
      </div>
    </div>
    <div id="moveRight">
      <svg width="20%" height="10%" viewBox="0 0 63 63" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M61.5 15C61.5 13 61.5 3.5 49 2.5L2.5 49C3.5 61.5 13 61.5 15 61.5H53C56.5899 61.5 61.5 56.5899 61.5 53V15Z" fill="#ffffff" stroke="#3D3D3D" stroke-width="3"/>
        <rect id = "back" x="2.5" y="2.5" width="53" height="53" rx="6.5" fill="white" stroke="#3D3D3D" stroke-width="3"/>
        <path id = "back" d="M41.5607 30.0607C42.1464 29.4749 42.1464 28.5251 41.5607 27.9393L32.0147 18.3934C31.4289 17.8076 30.4792 17.8076 29.8934 18.3934C29.3076 18.9792 29.3076 19.9289 29.8934 20.5147L38.3787 29L29.8934 37.4853C29.3076 38.0711 29.3076 39.0208 29.8934 39.6066C30.4792 40.1924 31.4289 40.1924 32.0147 39.6066L41.5607 30.0607ZM40.5 27.5H17V30.5H40.5V27.5Z" fill="#3D3D3D"/>
      </svg>
    </div>
    <div id="moveLeft"></div>
    <div id="backgroundImage"></div>
  </div>
  <div id="start"></div>
  <script src="https://pixijs.download/v6.1.0-rc.2/pixi.js"></script>
  <script src="js/gameLogic.js"></script>
  <script src="js/config.js"></script>
  <script src="js/state.js"></script>
  <script src="js/pushingPluses.js"></script>
  <script src="js/catchers.js"></script>
  <script src="js/start.js"></script>
  <script src="js/score.js"></script>
  <script src="js/goldPlus.js"></script>
  <script src="js/blastPluses.js"></script>
  <link rel="stylesheet" href="styles.css">
    <script>

      function restartAnim() {
        let restartButton = document.getElementById("GameOverRestartButton");
        restartButton.style.animation = ".25s ease-in changeColor";
        setTimeout(restart, 250)
      }
      function restart(){
        let restartButton = document.getElementById("GameOverRestartButton");
        restartButton.style.animation = '';
        initialization();
      }
      function changeColor(a,b){
        if (b === 1) {
          let q = document.getElementById(a);
          q.style.backgroundColor = "black";
        }

        if (b === 0) {
          let y = document.getElementById(a);
            
          y.style.backgroundColor = "white";
        }
      }
      let backgroundImage = document.getElementById("backgroundImage");
      let di = document.getElementById("background");

      function KeyDownHandler(e) {
        if (e.keyCode === 39) {
            state.rightPressed = true;
        }
        if (e.keyCode === 37) {
            state.leftPressed = true;
        }
        if(e.keyCode === 13) {
          skipStart();
        }
      }

      function KeyUpHandler(e) {
        if (e.keyCode === 39) {
            state.rightPressed = false;
        }
        if (e.keyCode === 37) {
            state.leftPressed = false;
        }
      }
      document.addEventListener("keydown", KeyDownHandler, false);
      document.addEventListener("keyup", KeyUpHandler, false);

      function TouchStartHandler(e) {
        if (state.startGame) {
          const touch = e.changedTouches?.[0];
          if (touch.clientX < Width / 2)
            state.leftPressed = true;
          else
            state.rightPressed = true;
        }
      }
      function TouchEndHandler(e) {
        if (!state.startGame) {
          restart();
        } else {
          state.leftPressed = state.rightPressed = false;
        }
      }
      document.addEventListener('touchstart', TouchStartHandler, false);
      document.addEventListener('touchend', TouchEndHandler, false);

      function MoveSh() {
        if (state.rightPressed && state.sh.x + state.fontSize < innerWidth) {
          state.sh.x += config.shSpeed;
        }
        if (state.leftPressed && 0 < state.sh.x) {
          state.sh.x -= config.shSpeed;
        }
      }

      function PlusMover() {
        for (let i = 0; i < state.pluses.falling.length; i++) {
          if (!state.pluses.falling[i].catched && !state.freezing) {
            state.pluses.falling[i].y += state.pluses.falling[i].speed * state.deltaTime;
          }
          else if (!state.pluses.falling[i].catched) {
            state.pluses.falling[i].y += state.pluses.falling[i].speed * state.deltaTime * 0.2;
          }
        }
      }
      function GameOver() {
        
        for (let i = 0; i < state.pluses.falling.length; i++) {
          let falling = state.pluses.falling[i]
          let plusSize = state.plusRealSize
          if (
            falling.y > state.shSizes.y - state.shSizes.h 
            && falling.y < state.shSizes.y) {
                if (
                  falling.x > state.shSizes.x 
                  && falling.x < state.shSizes.x + state.shSizes.w 
                  && falling.x + plusSize.width > state.shSizes.x 
                  && falling.x + plusSize.width < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;

                    app.stage.removeChild(falling)
                } else if (
                  falling.x > state.shSizes.x 
                  && falling.x < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;
                    app.stage.removeChild(falling)
                } else if (
                  falling.x + plusSize.width > state.shSizes.x 
                  && falling.x + plusSize.width < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;

                    app.stage.removeChild(falling)
                }
            }
        }
      }
      //Игровой счет -----------------------------------------------------------------------------------
      //Анимация взрыва плюсов -------------------------------------------------------------------------------------
      function GameOverBlastAnim() {
        for (let i = 0; i < state.pluses.gold.length; i++) {
          let goldPlus = state.pluses.gold[i];

          goldPlus.x += goldPlus.Xshag;
          goldPlus.y += goldPlus.Yshag;
          goldPlus.rotation += goldPlus.rotationStep;
          goldPlus.Yshag += config.gravity;
        }
        for (let i = 0; i < state.pluses.caughtPluses.length; i++) {
          let plusCaught = state.pluses.caughtPluses[i];

          plusCaught.x += plusCaught.Xshag;
          plusCaught.y += plusCaught.Yshag;
          plusCaught.Yshag += config.gravity;
          plusCaught.rotation += plusCaught.rotationStep;
        }

        state.sh.x += state.sh.shag.x;
        state.sh.y += state.sh.shag.y;
        state.sh.rotation += state.sh.rotationStep
        state.greyPlus.rotation += state.sh.rotationStep
        state.sh.shag.y += config.gravity;
        state.greyPlus.x += state.greyPlus.shag.x;
        state.greyPlus.y += state.greyPlus.shag.y;
        state.greyPlus.shag.y += config.gravity;
      }
      function dayMode(){
        
          di.className = 'day';
          state.sh.style.fill = "black"
          state.sh.style.stroke = "black"
          // state.greyPlus.style.stroke = "#3D3D3D"
          // state.greyPlus.style.fill = "#F8F8F8"
          state.scoreObject.style.fill = "#27AE60"
          state.scoreObject.style.stroke = "#27AE60"
       }
       function nightMode(){
         di.className = 'night';
        state.sh.style.fill = "white"
        state.sh.style.stroke = "white"
        // state.greyPlus.style.stroke = "white"
        // state.greyPlus.style.fill = "#3D3D3D"
        state.scoreObject.style.fill = "#FFD700"
        state.scoreObject.style.stroke = "#FFD700"
       }



      function difficultGame() {
        state.difficult = state.pluses.gold.length
        let a = state.difficult;
        if (a % 2 === 0) {
        	dayMode()
        } else {
        	nightMode()
        }

      }

      function Update() {
        state.scoreObject.x = innerWidth * 0.9;
        state.shSizes.w = state.shRealSize.width;
        state.shSizes.h = state.shRealSize.height;
        state.shSizes.x = state.sh.x;
        state.shSizes.y = state.sh.y + state.shRealSize.height / 2;
        state.sh.y = innerHeight - state.shRealSize.height;

        for (let i = 0; i < state.pluses.falling.length; i++) {
          if (state.pluses.falling[i].y > innerHeight) {
              app.stage.removeChild(state.pluses.falling[i])
              state.pluses.falling.splice(i, 1);
          }
        }
            
        if (state.pluses.gold.length > 0) {
          for (let i = 0; i < state.pluses.gold.length; i++) {
            if (state.pluses.gold[i].catched) {
                state.pluses.gold[i].x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (1 + i))
            }
          }
        }
            
        if (state.pluses.caughtPluses.length > 0) {
          state.greyPlus.x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (state.pluses.caughtPluses.length + 1 + state.catchedGoldPluses));
          state.greyPlus.y = state.sh.y;
          for (let i = 0; i < state.pluses.caughtPluses.length; i++) {
            state.pluses.caughtPluses[i].x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (1 + i + state.catchedGoldPluses));
            state.pluses.caughtPluses[i].y = state.sh.y;
          }
        } else {
          state.greyPlus.x = state.sh.x + config.greyDist + config.catchedPlusesDist * (state.pluses.caughtPluses.length + 1 + state.catchedGoldPluses);
          state.greyPlus.y = state.sh.y;
        }
      }
      let prevFrame = 0;
      app.ticker.add(() => {
        const now = Date.now();
        state.deltaTime = Math.min(6, (now - prevFrame) / 16);
        prevFrame = now;

        if (state.startGame) {
          FallingPlusCreater();
          PlusMover();
          if (!state.stop) {
            PlusCatcher();
            GoldPlusMove();
            GameScore();
            BlastPlusesNextSh();
            Update();
            isAllGoldPlusesCatched()
            BoomPlusesMove();
            MoveSh();
            CatcherAnimCaller();
            SayNumberKnockedPlusCaller();
            ScoreVariablesRemove();
            GoldPlus();
            GoldPlAnim();
            GoldCatcher();
            difficultGame();
            TransformPlusDelete();
          } else {
            GameOverBlastAnim();
            openMenu("Open");
          }
          GameOver();
        }
      });
    </script>
  </body>
</html>
