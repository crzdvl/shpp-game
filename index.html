<!DOCTYPE html>
<html lang = 'en'>
  <head>
    <meta charset="utf-8">
    <title>ш++</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Play">
    <style>
      body {
        margin: 0%;
        padding: 0%;
        overflow:hidden;
      }
    </style>
    <link rel="icon" href="https://media.geeksforgeeks.org/wp-content/cdn-uploads/gfg_200X200.png" type = "image/x-icon">
  </head>
  <body>
  <div id="background"></div>
  <div id="start"></div>
  <div id="MenuBackground">
    <div id="ButtonPlay" onclick="restart()">Грати знову</div>
    <div id="ButtonGoBack">Повернутися</div>
    <div id="menuCircleAnim1"></div>
    <div id="menuCircleAnim2"></div>
    <div id="shppIcon1">Ш</div>
    <div id="shppIcon2">++</div>
  </div>
  <script src="https://pixijs.download/v6.1.0-rc.2/pixi.js"></script>
  <script src="js/gameLogic.js"></script>
  <script src="js/config.js"></script>
  <script src="js/state.js"></script>
  <script src="js/pushingPluses.js"></script>
  <script src="js/catchers.js"></script>
  <script src="js/start.js"></script>
  <script src="js/score.js"></script>
  <script src="js/goldPlus.js"></script>
  <script src="js/blastPluses.js"></script>
  <link rel="stylesheet" href="styles.css">
    <script>
      function restart(){
          initialization();
      }
      function changeColor(a,b){
        if (b == 1) {
          let q = document.getElementById(a);
          q.style.backgroundColor = "black";
        }

        if (b == 0) {
          let y = document.getElementById(a);
            
          y.style.backgroundColor = "white";
        }
      }

      let di = document.getElementById("background");

      function KeyDownHandler(e) {
        if (e.keyCode === 39) {
            state.rightPressed = true;
        }
        if (e.keyCode === 37) {
            state.leftPressed = true;
        }
        if(e.keyCode === 13) {
          skipStart();
        }
      }

      function KeyUpHandler(e) {
        if (e.keyCode === 39) {
            state.rightPressed = false;
        }
        if (e.keyCode === 37) {
            state.leftPressed = false;
        }
      }
      document.addEventListener("keydown", KeyDownHandler, false);
      document.addEventListener("keyup", KeyUpHandler, false);

      function TouchStartHandler(e) {
        if (state.startGame) {
          const touch = e.changedTouches?.[0];
          if (touch.clientX < Width / 2)
            state.leftPressed = true;
          else
            state.rightPressed = true;
        }
      }
      function TouchEndHandler(e) {
        if (!state.startGame) {
          restart();
        } else {
          state.leftPressed = state.rightPressed = false;
        }
      }
      document.addEventListener('touchstart', TouchStartHandler, false);
      document.addEventListener('touchend', TouchEndHandler, false);

      function MoveSh() {
        if (state.rightPressed && state.sh.x + state.fontSize < innerWidth) {
          state.sh.x += config.shSpeed;
        }
        if (state.leftPressed && 0 < state.sh.x) {
          state.sh.x -= config.shSpeed;
        }
      }

      function PlusMover() {
        for (let i = 0; i < state.pluses.falling.length; i++) {
          if (!state.pluses.falling[i].catched) {
            state.pluses.falling[i].y += state.pluses.falling[i].speed * state.deltaTime;
          }
        }
      }
      function GameOver() {
        for (let i = 0; i < state.pluses.falling.length; i++) {
          let falling = state.pluses.falling[i]
          let plusSize = state.plusRealSize
          if (
            falling.y > state.shSizes.y - state.shSizes.h 
            && falling.y < state.shSizes.y) {
                if (
                  falling.x > state.shSizes.x 
                  && falling.x < state.shSizes.x + state.shSizes.w 
                  && falling.x + plusSize.width > state.shSizes.x 
                  && falling.x + plusSize.width < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;

                    app.stage.removeChild(falling)
                } else if (
                  falling.x > state.shSizes.x 
                  && falling.x < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;
                    app.stage.removeChild(falling)
                } else if (
                  falling.x + plusSize.width > state.shSizes.x 
                  && falling.x + plusSize.width < state.shSizes.x + state.shSizes.w 
                  && !falling.catched 
                  && !falling.kill) {
                    state.stop = true;
                    falling.kill = true;

                    app.stage.removeChild(falling)
                }
            }
        }
      }
      //Игровой счет -----------------------------------------------------------------------------------------------
      function test(){
        if(state.pluses.falling.length > 0){
          console.log()
        }
      }
      //Анимация взрыва плюсов -------------------------------------------------------------------------------------
      function GameOverBlastAnim() {
        for (let i = 0; i < state.pluses.gold.length; i++) {
          let goldPlus = state.pluses.gold[i];

          goldPlus.x += goldPlus.Xshag;
          goldPlus.y += goldPlus.Yshag;
          goldPlus.rotation += goldPlus.rotationStep;
          goldPlus.Yshag += config.gravity;
        }
        for (let i = 0; i < state.pluses.caughtPluses.length; i++) {
          let plusCaught = state.pluses.caughtPluses[i];

          plusCaught.x += plusCaught.Xshag;
          plusCaught.y += plusCaught.Yshag;
          plusCaught.Yshag += config.gravity;
          plusCaught.rotation += plusCaught.rotationStep;
        }

        state.sh.x += state.sh.shag.x;
        state.sh.y += state.sh.shag.y;
        state.sh.rotation += state.sh.rotationStep
        state.greyPlus.rotation += state.sh.rotationStep
        state.sh.shag.y += config.gravity;
        state.greyPlus.x += state.greyPlus.shag.x;
        state.greyPlus.y += state.greyPlus.shag.y;
        state.greyPlus.shag.y += config.gravity;
      }
       function dayMode(){
            di.style.backgroundColor = "#F8F8F8";
            state.sh.style.fill = "black"
            state.sh.style.stroke = "black"
            state.greyPlus.style.stroke = "#3D3D3D"
            state.greyPlus.style.fill = "#F8F8F8"
            state.scoreObject.style.fill = "#27AE60"
            state.scoreObject.style.stroke = "#27AE60"

       }
       function nightMode(){
            di.style.backgroundColor = "#3D3D3D";
            state.sh.style.fill = "white"
            state.sh.style.stroke = "white"
            state.greyPlus.style.stroke = "white"
            state.greyPlus.style.fill = "#3D3D3D"
            state.scoreObject.style.fill = "#FFD700"
            state.scoreObject.style.stroke = "#FFD700"

       }



      function difficultGame() {
        state.difficult = state.pluses.gold.length
        let a = state.difficult;
        if (a === 0 || a === 2 || a ===4 || a === 6) {
        	dayMode()
        }
        if (a === 1 || a === 3 || a === 5) {
        	nightMode()
        }

      }

      function Update() {
        state.shSizes.w = state.shRealSize.width;
        state.shSizes.h = state.shRealSize.height;
        state.shSizes.x = state.sh.x;
        state.shSizes.y = state.sh.y + state.shRealSize.height / 2;
        state.sh.y = innerHeight - state.shRealSize.height;

        for (let i = 0; i < state.pluses.falling.length; i++) {
          if (state.pluses.falling[i].y > innerHeight) {
              state.pluses.falling.splice(i, 1);
          }
        }
            
        if (state.pluses.gold.length > 0) {
          for (let i = 0; i < state.pluses.gold.length; i++) {
            if (state.pluses.gold[i].catched) {
                state.pluses.gold[i].x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (1 + i))
            }
          }
        }
            
        if (state.pluses.caughtPluses.length > 0) {
          state.greyPlus.x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (state.pluses.caughtPluses.length + 1 + state.catchedGoldPluses));
          state.greyPlus.y = state.sh.y;
          for (let i = 0; i < state.pluses.caughtPluses.length; i++) {
            state.pluses.caughtPluses[i].x = state.sh.x + config.greyDist + (config.catchedPlusesDist * (1 + i + state.catchedGoldPluses));
            state.pluses.caughtPluses[i].y = state.sh.y;
          }
        } else {
          state.greyPlus.x = state.sh.x + config.greyDist + config.catchedPlusesDist * (state.pluses.caughtPluses.length + 1 + state.catchedGoldPluses);
          state.greyPlus.y = state.sh.y;
        }
      }
      let prevFrame = 0;
      app.ticker.add(() => {
        const now = Date.now();
        state.deltaTime = Math.min(6, (now - prevFrame) / 16);
        prevFrame = now;

        if (state.startGame) {
          if (!state.stop) {

            FallingPlusCreater();
            PlusCatcher();
            GoldPlusMove();
            GameScore();
            BlastPlusesNextSh();
            Update();
            isAllGoldPlusesCatched()
            BoomPlusesMove();
            MoveSh();
            PlusMover();
            CatcherAnimCaller();
            SayNumberKnockedPlusCaller();
            ScoreVariablesRemove();
            GoldPlus();
            GoldPlAnim();
            GoldCatcher();
            difficultGame();
            TransformPlusDelete();
          } else {
            GameOverBlastAnim();
            openMenu("Open");
          }
          GameOver();
        }
      });
    </script>
  </body>
</html>
