<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <style>
        body {
            margin: 0%;
            padding: 0%;
        }
    </style>
</head>
<script src="pixi.js"></script>

<body>
    <script>
        app = new PIXI.Application({
            width: document.body.offsetWidth,
            height: innerHeight - 4,
            backgroundColor: 0xffffff
        })
        //config-----------------------------------------------------------------------------------
        var config = {
            menu: {
                x: 0,
                y: 0,
                h: 0,
                w: 0,
                buttons: {
                    exit: {
                        x: 0,
                        y: 0,
                        h: 0,
                        w: 0,
                    },
                    shPlDist: 0,
                    restart: {
                        x: 0,
                        y: 0,
                        h: 0,
                        w: 0,
                    }
                }
            },
            font: innerWidth / 10,
            colours: {
                menu: {
                    color: "gray",
                    buttons: 0,
                },
                sh: "black",
                pluses: {
                    common: "green",
                    boom: "grey",
                },
            },
            limitSh: {
                l: 0,
                r: innerWidth,
            },
            speed: 0
        }
        config.speed = config.font * 0.20
        //styles----------------------------------------------------
        var plStyle = new PIXI.TextStyle({
            fill: "green",
            fontSize: innerWidth / 10,
            strokeThickness: 4,
        });
        var shStyle = new PIXI.TextStyle({
            fill: "black",
            fontSize: innerWidth / 10,
            strokeThickness: 4,

        });
        var punktPlusStyle = new PIXI.TextStyle({
            fill: "gray",
            fontSize: innerWidth / 10,
            stroke: "black",
            strokeThickness: 4
        });
        var scoreStyle = new PIXI.TextStyle({
            fill: "green",
            fontSize: innerWidth / 10,
            stroke: "black",
            strokeThickness: 8
        });
        //state--------------------------------------------------------------------------------------------------------
        var state = {
            pluses: [{
                coord: 0,
                falling: 1,
                catched: false,
                onPlace: 0,
                boom: new PIXI.Text("+", plStyle),
                colision: new PIXI.Text("+", plStyle)
            }],
            rightPressed: false,
            leftPressed: false,
            scet: 0,
            score: new PIXI.Text("0", scoreStyle),
            sh: new PIXI.Text("ле", shStyle),
            greyPlus: new PIXI.Text("+", punktPlusStyle),
            button: {
                left: false,
                right: false,
                lnum: 37,
                rnum: 39,
            },
            stop: false,
        }
        //functions----------------------------------------------------------------------------------------------------
        document.addEventListener("keydown", keyDownHandler, false);
        document.addEventListener("keyup", keyUpHandler, false);

        function initialization() {
            state.pluses.falling = [];
            state.pluses.falling.length = 0;
            state.pluses.onPlace = []
            state.pluses.onPlace.length = 0
            config.shPlDist = state.sh.x + config.font + config.font / 12
            state.greyPlus.x = state.sh.x + config.shPlDist
            state.sh.x = innerWidth / 2 - config.font / 2
            state.sh.y = innerHeight - config.font
            state.coord = [];
        }

        initialization();

        function keyDownHandler(e) {
            if (e.keyCode == 39) {
                state.rightPressed = true;
            }
            if (e.keyCode == 37) {
                state.leftPressed = true;
            }
        }

        function keyUpHandler(e) {
            if (e.keyCode == 39) {
                state.rightPressed = false;
            }
            if (e.keyCode == 37) {
                state.leftPressed = false;
            }
        }

        function Shmover() {
            if (state.rightPressed == true && state.sh.x + config.font < innerWidth) {
                state.sh.x += config.speed;
            }
            if (state.leftPressed == true && 0 < state.sh.x) {
                state.sh.x -= config.speed;
            }
        }

        function PlusPusher() {
            if (state.pluses.falling.length == 0) {
                state.pluses.falling.push(new PIXI.Text("+", plStyle))
                state.pluses.falling[state.pluses.falling.length - 1].catched = false;
                state.pluses.falling[state.pluses.falling.length - 1].onPlace = false;
                state.pluses.falling[state.pluses.falling.length - 1].x = Math.floor(Math.random() * ((innerWidth -
                    config.font) + config.font * 2));
                state.pluses.falling[state.pluses.falling.length - 1].y = -110;
                state.pluses.falling[state.pluses.falling.length - 1].mvx = 0;
                state.pluses.falling[state.pluses.falling.length - 1].mvy = 0;
                state.pluses.falling[state.pluses.falling.length - 1].mvgravity = 0;
                app.stage.addChild(state.pluses.falling[0])
            }
            if (state.pluses.falling[state.pluses.falling.length - 1].y > 120) {
                state.pluses.falling.push(new PIXI.Text("+", plStyle))
                state.pluses.falling[state.pluses.falling.length - 1].catched = false;
                state.pluses.falling[state.pluses.falling.length - 1].onPlace = false;
                state.pluses.falling[state.pluses.falling.length - 1].x = Math.floor(Math.random() * innerWidth - 100);
                state.pluses.falling[state.pluses.falling.length - 1].y = -100;
                state.pluses.falling[state.pluses.falling.length - 1].mvx = 0;
                state.pluses.falling[state.pluses.falling.length - 1].mvy = 0;
                state.pluses.falling[state.pluses.falling.length - 1].mvgravity = 0;

                app.stage.addChild(state.pluses.falling[state.pluses.falling.length - 1])
            }
        }

        function PlusMover() {
            for (let i = 0; i < state.pluses.falling.length; i++) {
                if (!state.pluses.falling[i].catched) {
                    state.pluses.falling[i].y += config.font / 25;
                }
            }
        }

        function PlusCatcher() {
            for (let i = 0; i < state.pluses.falling.length; i++) {
                if (
                    state.pluses.falling[i].y < innerHeight - config.font / 1.5 &&
                    state.pluses.falling[i].y > innerHeight - config.font * 1.5 &&
                    state.pluses.falling[i].catched == false
                ) {
                    if (
                        state.pluses.falling[i].x > state.greyPlus.x - config.font / 2 &&
                        state.pluses.falling[i].x < state.greyPlus.x + config.font / 2
                    ) {
                        state.pluses.falling[i].catched = true;
                        app.stage.removeChild(state.pluses.falling[i])
                        state.coord.push({
                            x:state.greyPlus.x,
                            y:state.greyPlus.y,
                        })
                        state.scet += 1
                        state.greyPlus.x = (state.sh.x + config.shPlDist) * state.scet
                        PlusOnPlace(state.pluses.falling[i].x,state.pluses.falling[i].y)
                    }
                }
            }
        }

        function Update() {
            if (state.pluses.onPlace.length > 0) {
                state.greyPlus.x = state.sh.x + (config.shPlDist * (state.scet+1))
                state.greyPlus.y = state.sh.y
                for (let i = 0; i < state.pluses.onPlace.length;i++){
                    state.pluses.onPlace[i].x = state.sh.x + (config.shPlDist * (1+i))
                }
            } else {
                state.greyPlus.x = state.sh.x + config.shPlDist * (state.scet+1)
                state.greyPlus.y = state.sh.y
            }
        }
        function PlusOnPlace(X,Y) {

            state.pluses.onPlace.push(new PIXI.Text("+", plStyle))
            state.pluses.onPlace[state.pluses.onPlace.length-1].x = X;
            state.pluses.onPlace[state.pluses.onPlace.length-1].y = Y;
            app.stage.addChild(state.pluses.onPlace[state.pluses.onPlace.length-1])
        }
        function PlusCatcherAnim() {
            for (plus of state.pluses.onPlace) {
                let shagY = (state.coord.y - plus.y) / 6;
                let shagX = (state.coord.x - plus.x) / 2;
                 
                    if (plus.x < state.coord[0].x && !plus.onPlace) {
                        plus.x += shagX;
                    }
                    if (plus.x > state.coord[0].x && !plus.onPlace) {
                        plus.x += shagX;
                    }
                    if (plus.y < state.greyPlus.y && !plus.onPlace) {
                        plus.y += shagY;
                    }
                    if (plus.y > state.coord.y - 1) {
                        plus.y = state.coord.y
                        plus.x = state.coord.x
                        plus.onPlace = true;
                    }
                }
            }
        
        document.body.appendChild(app.view);
        app.stage.addChild(state.sh)
        app.stage.addChild(state.greyPlus)

        app.ticker.add(() => {
            PlusCatcher();
            Update();
            Shmover();
            PlusPusher();
            PlusMover();
            PlusCatcherAnim();
        });
    </script>
</body>

</html>